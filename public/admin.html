<html>
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="renderer" content="webkit">
    <meta charset="utf-8">
    <title>清晨好文章</title>
    <link href="raclen.ico" rel="Shortcut Icon">
    <link rel="stylesheet" href="css/resest.css"/>
    <link rel="stylesheet" href="css/admin.css"/>
    <link rel="stylesheet" href="js/editor/themes/default/default.css"/>
</head>
<body>
<div class="page admin">
    <div class="head" id="header">
        <div class="head_box">
            <div class="inner wrp">
                <h1 class="logo">清晨好文章</h1>

                <div class="account_meta account_logout">
                    <a id="username" href="">九木旭</a>
                    <a id="logout" href="">退出</a>
                </div>
            </div>
        </div>
    </div>

    <div id="body" class="body page_mass_send">
        <div class="container_box cell_layout side_l">
            <div class="col_side">
                <div class="menu_box" id="menuBar">
                    <dl class="menu no_extra">
                        <dt class="menu_title">
                            <i class="icon_menu">
                            </i>功能
                        </dt>

                        <dd class="menu_item selected"><a href="javascript:void(0)">撰写文章</a></dd>
                        <dd class="menu_item "><a href="javascript:void(0)">删除文章</a></dd>
                        <dd class="menu_item "><a href="javascript:void(0)">添加管理员</a></dd>
                        <dd class="menu_item "><a href="javascript:void(0)">意见反馈</a></dd>
                        <dd class="menu_item "><a href="javascript:void(0)">待定 </a></dd>
                    </dl>

                </div>

            </div>

            <div class="col_main">
                <div class="main-item">
                    <div class="main_hd">
                        <h2>撰写文章</h2>
                    </div>
                    <div class="main_bd">
                        <div class="appmsg_editor">
                            <div class="inner">
                                <div class="appmsg_edit_item">
                                    <label class="frm_label">标题</label>
                                    <span class="frm_input_box with_counter counter_in append count">
                                    <input type="text" id="title" class="frm_input js_title js_counter" max-length="64">

                                   </span>
                                </div>
                                <div class="appmsg_edit_item">
                                    <label class="frm_label">
                                        <strong class="title">作者</strong>

                                        <p class="tips l">（选填）</p>
                                    </label>
                                             <span class="frm_input_box with_counter counter_in append count">
                                        <input type="text" id="author" class="frm_input js_author js_counter"
                                               max-length="8">

                                        </span>


                                </div>

                                <div class="appmsg_edit_item">
                                    <label class="frm_label">正文</label>
     <span class="frm_input_box with_counter counter_in append count">
                                    <textarea id="editor_id" name="content" style="width:700px;height:300px;">
                                        &lt;strong&gt;HTML内容&lt;/strong&gt;
                                    </textarea>
                                    </span>
                                </div>
                            </div>
                        </div>
                        <a href="javascript:void(0)" id="js_submit" class="btn-submit"> 发表</a>
                    </div>
                </div>
                <div class="main-item">
                    <div class="main_hd">
                        <h2>删除文章</h2>
                    </div>
                    <div class="main_bd">
                        <table class="table table-bordered">
                            <thead>
                            <tr>
                                <th>文章名称</th>
                                <th>作者</th>
                                <th>操作</th>
                            </tr>
                            </thead>
                            <tbody id="actionList">
                            <!--    <tr>
                                    <td>美好的日子</td>
                                    <td>九木旭</td>
                                    <td><a href="javascript:void(0)" data-articleid="">删除</a></td>
                                </tr>-->

                            </tbody>
                        </table>
                        <div class="paging"><a href="javascript:void(0)" class="pre dis">上一页</a><a
                                href="javascript:void(0)" class="next">下一页</a></div>
                    </div>
                </div>
            </div>

        </div>
    </div>

</div>

</div>
<script src="//www.wanlitong.com/app_js/wanlitong/v40/wap/vendor/zepto/dist/zepto.min.js"></script>
<script charset="utf-8" src="js/editor/kindeditor.js"></script>
<script>
    //生产编辑器
    var editor;
    KindEditor.ready(function (K) {
        editor = K.create('textarea[name="content"]', {
            allowFileManager: true
        });

    });

    //页码page
    var categorypage = 1;
    var admin = {
        findarticle: function (p, id) {
            $.ajax({
                url: '/category',
                type: 'GET',
                data: {
                    page: p,
                    categoryid: id
                },
                dataType: 'json',
                beforeSend: function () {
                },
                success: function (res) {
                    $('#actionList').html('');
                    var data=res.items;
                    for (var i = 0, len = data.length; i < len; i++) {
                        $('#actionList').append(
                                '<tr>' +
                                '<td>' + data[i].title + '</td>' +
                                '<td>' + data[i].author + '</td>' +
                                '<td><a href="javascript:void(0)" data-articleid="' + data[i].articleid + '" class="del-btn">删除</a></td>' +
                                '</tr>'
                        );
                    }
                    //最后一页了
                    var tolpage=parseInt(res.pagenum/10)+1;
                    if(categorypage==tolpage){
                            $('.next').addClass('dis');

                    }
                    $('.del-btn').on('click', function () {
                        var articleid = $(this).data('articleid');
                        admin.delarticle(articleid);
                    })
                }
            })
        },
        delarticle: function (id) {
            $.ajax({
                url: '/delarticle',
                type: 'GET',
                data: {
                    articleid: id
                },
                dataType: 'json',
                success: function (data) {
                    if (data.statusCode == '0000') {
                        alert('文章删除成功');
                        location.reload();
                    }


                }
            })
        }
    }

    $('#js_submit').on('click', function () {
        var title = $('#title').val();
        var author = $('#author').val();
        var editorcontent = editor.html();
        if ($.trim(title) == '') {
            alert('标题不能为空');
            return;
        }
        if ($.trim(editorcontent) == '') {
            alert('正文不能为空');
            return;
        }
        var baseUrl = '';
        // var baseUrl='http://raclen-wenzhang.coding.io';
        var API_ADDARTICLE = baseUrl + '/addarticle';
        $.ajax({
            url: API_ADDARTICLE,
            type: 'POST',
            data: {
                title: title,
                author: author,
                editorcontent: editorcontent
            },
            dataType: 'json',

            success: function (data) {
                if (data.statusCode == '0000')
                    alert('感谢你的贡献，文章添加成功');

            }
        })
    })
    var $menuitem = $('.menu_item');
    var $mainitem = $('.col_main  .main-item')
    $menuitem.on('click', function () {
        $menuitem.removeClass('selected');
        $(this).addClass('selected');
        var _index = $('.menu_item').index(this);
        // alert(_index);
        $mainitem.hide();
        $mainitem.eq(_index).show();
        admin.findarticle(1, '004');

    })
    $('.pre').on('click', function () {
        categorypage=--categorypage;
        $('.next').removeClass('dis');
        if(categorypage==1){
            $(this).addClass('dis');
        }
        admin.findarticle(categorypage, '004');

    })
    $('.next').on('click', function () {
        categorypage=++categorypage;
        $('.pre').removeClass('dis');
        admin.findarticle(categorypage, '004');

    })
</script>
</body>
</html>